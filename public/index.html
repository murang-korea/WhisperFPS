<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WhisperBattle (테스트)</title>
  <style>
    canvas { background: #111; display: block; margin: 0 auto; touch-action: none; }
  </style>
</head>
<body>
  <canvas id="game" width="600" height="400"></canvas>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    const socket = io("https://YOUR_RENDER_SERVER_URL_HERE"); // 나중에 Render 주소 넣기
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let players = {};
    let me = null;

    // 서버에서 현재 플레이어들 받기
    socket.on("currentPlayers", (serverPlayers) => {
      players = serverPlayers;
      me = players[socket.id];
    });

    // 새 플레이어 등장
    socket.on("newPlayer", (player) => {
      players[player.id] = player;
    });

    // 플레이어 이동 업데이트
    socket.on("playerMoved", (data) => {
      if (players[data.id]) {
        players[data.id].x = data.x;
        players[data.id].y = data.y;
      }
    });

    // 플레이어 나감
    socket.on("playerDisconnected", (id) => {
      delete players[id];
    });

    // 이동
    document.addEventListener("keydown", (e) => {
      if (!me) return;
      const step = 10;
      if (e.key === "ArrowUp") me.y -= step;
      if (e.key === "ArrowDown") me.y += step;
      if (e.key === "ArrowLeft") me.x -= step;
      if (e.key === "ArrowRight") me.x += step;
      socket.emit("move", { x: me.x, y: me.y });
    });

    // 그리기 루프
    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (const id in players) {
        const p = players[id];
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
        ctx.fill();
      }
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
